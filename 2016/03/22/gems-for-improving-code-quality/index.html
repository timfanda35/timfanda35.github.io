<!doctype html><html lang=en-us>
<head>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=x-ua-compatible content="ie=edge,chrome=1">
<title>推薦協助提高程式碼品質的 Gem &#183; Bear Su's Blog - Running Bear!!! </title>
<meta name=generator content="Hugo 0.92.0">
<meta name=description content="Running Bear!!!">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.bear-su.dev/images/bear.jpeg">
<meta name=twitter:title content="推薦協助提高程式碼品質的 Gem">
<meta name=twitter:description content="用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質
這篇推薦幾個 gem：
Brakeman - 檢查安全性
Bullet - 檢查 N+1 Query
RubyCritic - 靜態分析程式碼(已整合多套工具)
New Relic RPM - 監測網站效能">
<meta property="og:title" content="推薦協助提高程式碼品質的 Gem">
<meta property="og:description" content="用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質
這篇推薦幾個 gem：
Brakeman - 檢查安全性
Bullet - 檢查 N+1 Query
RubyCritic - 靜態分析程式碼(已整合多套工具)
New Relic RPM - 監測網站效能">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.bear-su.dev/2016/03/22/gems-for-improving-code-quality/"><meta property="og:image" content="https://blog.bear-su.dev/images/bear.jpeg"><meta property="article:section" content>
<meta property="article:published_time" content="2016-03-22T11:28:00+08:00">
<meta property="article:modified_time" content="2016-03-22T11:28:00+08:00">
<link href rel=alternate type=application/rss+xml title="Bear Su's Blog">
<link href rel=feed type=application/rss+xml title="Bear Su's Blog">
<meta itemprop=name content="推薦協助提高程式碼品質的 Gem">
<meta itemprop=description content="用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質
這篇推薦幾個 gem：
Brakeman - 檢查安全性
Bullet - 檢查 N+1 Query
RubyCritic - 靜態分析程式碼(已整合多套工具)
New Relic RPM - 監測網站效能"><meta itemprop=datePublished content="2016-03-22T11:28:00+08:00">
<meta itemprop=dateModified content="2016-03-22T11:28:00+08:00">
<meta itemprop=wordCount content="248"><meta itemprop=image content="https://blog.bear-su.dev/images/bear.jpeg">
<meta itemprop=keywords content>
<link href="https://fonts.googleapis.com/css?family=Lato:400" rel=stylesheet>
<link rel=stylesheet href=https://blog.bear-su.dev/css/style.css>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"WebSite","name":"Bear Su\u0027s Blog","url":"https:\/\/blog.bear-su.dev\/2016\/03\/22\/gems-for-improving-code-quality\/"}</script>
</head>
<body>
<header class=gheader>
<div class=container>
<nav class=navbar>
<div class=navbar-brand>
<a class=navbar-item href=https://blog.bear-su.dev>
<p class=brand>Bear Su's Blog</p>
</a>
<div class="navbar-burger burger" data-target=navMenubd-example>
<span></span>
<span></span>
<span></span>
</div>
</div>
<div id=navMenubd-example class=navbar-menu>
<div class=navbar-start>
<a class=navbar-item href=/categories/>
Categories
</a>
<a class=navbar-item href=https://github.com/timfanda35>
GitHub
</a>
<a class=navbar-item href=https://www.linkedin.com/in/bearsu>
Linkedin
</a>
<a class=navbar-item href=https://twitter.com/Fandayo>
Twitter
</a>
</div>
</div>
</nav>
</div>
</header>
<div class=main-content>
<div class=container>
<article class=post>
<header class=post-header>
<h1 class=title>推薦協助提高程式碼品質的 Gem</h1>
<div class=meta>
<time class=pub-time datetime=2016-03-22T11:28:00+08:00>
2016.03.22
</time>
<div class=terms>
<div class=categories>
<a class=categories-item href=/categories/ruby>ruby</a>
<a class=categories-item href=/categories/rails>rails</a>
<a class=categories-item href=/categories/brakeman>brakeman</a>
<a class=categories-item href=/categories/bullet>bullet</a>
<a class=categories-item href=/categories/rubycritic>rubycritic</a>
<a class=categories-item href=/categories/newrelic>newrelic</a>
<a class=categories-item href=/categories/gem>gem</a>
</div>
</div>
</div>
</header>
<div class=post-body>
<div class=toc-wrap>
<h2>Table of Contents</h2>
<nav id=TableOfContents>
<ul>
<li><a href=#brakemanhttpsgithubcompresidentbeefbrakeman><a href=https://github.com/presidentbeef/brakeman>Brakeman</a></a></li>
<li><a href=#bullethttpsgithubcomflyerhzmbullet><a href=https://github.com/flyerhzm/bullet>Bullet</a></a></li>
<li><a href=#rubycritichttpsgithubcomwhitesmithrubycritic><a href=https://github.com/whitesmith/rubycritic>RubyCritic</a></a></li>
<li><a href=#new-relic-rpmhttpsgithubcomnewrelicrpm><a href=https://github.com/newrelic/rpm>New Relic RPM</a></a></li>
</ul>
</nav>
</div>
<p>用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質</p>
<p>這篇推薦幾個 gem：</p>
<p><a href=https://github.com/presidentbeef/brakeman>Brakeman - 檢查安全性</a></p>
<p><a href=https://github.com/flyerhzm/bullet>Bullet - 檢查 N+1 Query</a></p>
<p><a href=https://github.com/whitesmith/rubycritic>RubyCritic - 靜態分析程式碼(已整合多套工具)</a></p>
<p><a href=https://github.com/newrelic/rpm>New Relic RPM - 監測網站效能</a></p>
<h2 id=brakemanhttpsgithubcompresidentbeefbrakeman><a href=https://github.com/presidentbeef/brakeman>Brakeman</a> <a href=#brakemanhttpsgithubcompresidentbeefbrakeman>¶</a></h2>
<hr>
<p>Brakeman 可以用來分析程式碼，以檢測網站的安全性問題提出報告作為改善參考</p>
<p>可以直接在終端機輸入指令安裝 gem：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gem install brakeman
</code></pre></div><p>或是修改專案中的 <code>Gemfile</code> 透過 <code>bundle</code> 安裝</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>group <span style=color:#e6db74>:development</span> <span style=color:#66d9ef>do</span>
  gem <span style=color:#e6db74>&#39;brakeman&#39;</span>, <span style=color:#e6db74>:require</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>因為只有開發環境才會用到，所以通常都放在 <code>development</code> 群組中</p>
<p>這裡只是用來在 <code>bundle install</code> 一併安裝 Brakeman，在專案應用執行過程中並不會引用到 Brakman，所以將 <code>require</code> 設為 <code>false</code></p>
<p>使用 Brakeman 很簡單，於終端機在專案目錄下執行指令：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>brakeman
</code></pre></div><p>就會批哩啪啦地跑出檢測報告了</p>
<p>接著就可以依照檢測報告改善程式碼</p>
<h2 id=bullethttpsgithubcomflyerhzmbullet><a href=https://github.com/flyerhzm/bullet>Bullet</a> <a href=#bullethttpsgithubcomflyerhzmbullet>¶</a></h2>
<hr>
<p>通常都會用 Bullet 來檢查 N + 1 Query 問題(對資料庫額外執行多個查詢子句而影響效能)</p>
<p>Bullet 會在執行查詢的時候，將發生 N + 1 Query 的部分輸出於 log 上</p>
<p>修改專案中的 <code>Gemfile</code> 透過 <code>bundle</code> 安裝</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>group <span style=color:#e6db74>:test</span>, <span style=color:#e6db74>:development</span> <span style=color:#66d9ef>do</span>
  gem <span style=color:#e6db74>&#39;bullet&#39;</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>將 Bullet 加入到 <code>development</code> 與 <code>test</code> 群組以看到 Bullet 所產生的 log</p>
<p>修改 <code>config/environments/test.rb</code>，加入以下設定</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>config<span style=color:#f92672>.</span>after_initialize <span style=color:#66d9ef>do</span>
  <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>enable <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
  <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>bullet_logger <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>
  <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>raise <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span> <span style=color:#75715e># raise an error if n+1 query occurs</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>並在 <code>spec/spec_helper.rb</code> 或 <code>spec/rails_helper.rb</code> 中加入以下設定</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#66d9ef>RSpec</span><span style=color:#f92672>.</span>configure <span style=color:#66d9ef>do</span> <span style=color:#f92672>|</span>config<span style=color:#f92672>|</span>

  <span style=color:#75715e># other configures...</span>
  
  <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>enable?
    config<span style=color:#f92672>.</span>before(<span style=color:#e6db74>:each</span>) <span style=color:#66d9ef>do</span>
      <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>start_request
    <span style=color:#66d9ef>end</span>

    config<span style=color:#f92672>.</span>after(<span style=color:#e6db74>:each</span>) <span style=color:#66d9ef>do</span>
      <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>perform_out_of_channel_notifications <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>notification?
      <span style=color:#66d9ef>Bullet</span><span style=color:#f92672>.</span>end_request
    <span style=color:#66d9ef>end</span>
  <span style=color:#66d9ef>end</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>這樣在跑測試的時候，如果有 N + 1 Query 時就會無法通過測試</p>
<p>再依照出現的訊息去改善程式吧</p>
<h2 id=rubycritichttpsgithubcomwhitesmithrubycritic><a href=https://github.com/whitesmith/rubycritic>RubyCritic</a> <a href=#rubycritichttpsgithubcomwhitesmithrubycritic>¶</a></h2>
<hr>
<p>RubyCritic 整合了多個靜態分析程式碼的工具像是 <a href=https://github.com/troessner/reek>Reek</a>, <a href=https://github.com/seattlerb/flay>Flay</a> and <a href=https://github.com/seattlerb/flog>Flog</a>，產生報表用以檢視專案的程式碼品質與改善建議</p>
<p>可以直接在終端機輸入指令安裝 gem：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>gem install rubycritic
</code></pre></div><p>或是修改專案中的 <code>Gemfile</code> 透過 <code>bundle</code> 安裝</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>group <span style=color:#e6db74>:development</span> <span style=color:#66d9ef>do</span>
  gem <span style=color:#e6db74>&#39;rubycritic&#39;</span>, <span style=color:#e6db74>:require</span> <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>false</span>
<span style=color:#66d9ef>end</span>
</code></pre></div><p>通常都是在 <code>development</code> 環境下，於專案目錄下執行指令：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>rubycritic
</code></pre></div><p>檢測結束後，就會自動開啟瀏覽器顯示報告</p>
<h2 id=new-relic-rpmhttpsgithubcomnewrelicrpm><a href=https://github.com/newrelic/rpm>New Relic RPM</a> <a href=#new-relic-rpmhttpsgithubcomnewrelicrpm>¶</a></h2>
<hr>
<p>New Relic 是廣為人知的網站效能檢測服務，有提供免費方案足以應付小型網站的需求</p>
<p>而且所提供的 <code>new_relic_rpm</code> gem 可以在<code>development</code> 環境中在本機端直接查看效能分析</p>
<p>修改專案中的 <code>Gemfile</code> 透過 <code>bundle</code> 安裝</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby>gem <span style=color:#e6db74>&#39;newrelic_rpm&#39;</span>
</code></pre></div><p>執行指令產生設定檔 <code>config/newrelic.yml</code></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>newrelic install --license_key<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;YOUR_KEY&#34;</span> <span style=color:#e6db74>&#34;My application&#34;</span>
</code></pre></div><p><strong>YOUR_KEY</strong> 是在 New Relic 官網取得的 License Key</p>
<p><strong>My application</strong> 是自訂的應用程式名稱</p>
<p>只是想在開發環境測試時，或還沒在 New Relic 官網建立，以上資料可以先隨意填就好</p>
<p>接著執行 <code>rails s</code> 啟動專案，在瀏覽器輸入 <code>http://localhost:3000/newrelic</code></p>
<p>就可以看到測試環境用的除錯頁面了</p>
<p>執行專案網站中的幾項操作，回到 <code>http://localhost:3000/newrelic</code> 就能夠看到剛剛操作的執行時間</p>
<p>接下來就可以針對較慢的部分調整程式碼了！</p>
<hr>
<p>以上的 gem 結合了眾人的智慧，提供許多改善程式碼的參考</p>
<p>相信能夠在精進技術的路上提供不少幫助，多多利用吧！</p>
</div>
<footer class=post-footer>
<hr>
<div style=margin-top:2.5rem>
<div style=display:flex;justify-content:center;width:100%>
<p style=color:gray>
如果覺得這篇文章對您有所幫助，歡迎贊助我一杯咖啡 ☕️
</p>
</div>
<div style=display:flex;justify-content:center;width:100%>
<p style=color:gray>
祝您有美好的一天 ❤️
</p>
</div>
<div style=display:flex;justify-content:center;width:100%;margin-top:1rem>
<script type=text/javascript src=https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js data-name=bmc-button data-slug=timfanda35 data-color=#FFDD00 data-emoji data-font=Bree data-text="Buy me a coffee" data-outline-color=#000000 data-font-color=#000000 data-coffee-color=#ffffff></script>
</div>
</div>
<hr>
<div style=margin-top:1rem>
<script src=https://utteranc.es/client.js repo=timfanda35/timfanda35.github.io issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script>
</div>
<div class=share>
</div>
<div class=pagenation>
<ul class=pagenation-list>
<li class="pager previous">
<a href=https://blog.bear-su.dev/2016/03/04/weekly-collection/ data-toggle=tooltip data-placement=top title=週刊收集>&larr; Previous Post</a>
</li>
<li class="pager next">
<a href=https://blog.bear-su.dev/2016/04/21/installrails/ data-toggle=tooltip data-placement=top title="Rails 安裝教學">Next Post &rarr;</a>
</li>
</ul>
</div>
</footer>
</article>
<article class=related></article>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"NewsArticle","mainEntityOfPage":{"@type":"NewsArticle","@id":"https:\/\/blog.bear-su.dev\/2016\/03\/22\/gems-for-improving-code-quality\/","headline":"用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質這篇推薦幾個 gem：Brakeman - 檢查安全性Bullet - 檢查 N\u002b1 QueryRubyCritic - 靜態","author":"Bear Su","publisher":{"@type":"Organization","name":"Bear Su","logo":""},"image":"","datePublished":"2016-03-22"},"headline":"用 Rails 開發網站時除了寫測試之外，還可以透過一些 gem 來協助維護 code 的品質這篇推薦幾個 gem：Brakeman - 檢查安全性Bullet - 檢查 N\u002b1 QueryRubyCritic - 靜態","alternativeHeadline":"Bear Su\u0027s Blog","datePublished":"2016-03-22","dateModified":"2016-03-22","url":"https:\/\/blog.bear-su.dev\/2016\/03\/22\/gems-for-improving-code-quality\/","wordCount":"248","author":{"@type":"Person","name":"Bear Su"},"publisher":{"@type":"Organization","name":"Bear Su"},"image":"","genre":"rubyrailsbrakemanbulletrubycriticnewrelicgem","description":""}</script>
<script type=application/ld+json>{"@context":"http://schema.org","@type":"Person","@id":"https:\/\/blog.bear-su.dev\/2016\/03\/22\/gems-for-improving-code-quality\/","name":"Bear Su"}</script>
</div>
</div>
<footer class=gfooter>
<div class=inner>
<div class=container>
<p class=copy>
<small>Copyright © 2015 - 2022 Bear Su's Blog</small>
<small> | 本部落格有使用 Google Analytic 及 Cookie</small>
</p>
<nav class=footer-nav>
<div class=inner>
</div>
</nav>
</div>
</div>
</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KJXNT5CQCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-KJXNT5CQCS',{anonymize_ip:!1})}</script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin=anonymous referrerpolicy=no-referrer></script>
<script src=https://blog.bear-su.dev/js/script.js></script>
</body>
</html>